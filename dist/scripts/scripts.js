"use strict";angular.module("homey",["ngAnimate","ui.router","ngStorage","ui.bootstrap.datetimepicker","angularMoment"]).config(["$stateProvider","$urlRouterProvider","$httpProvider",function(a,b,c){c.interceptors.push("AuthInterceptor"),b.otherwise("/"),a.state("/",{url:"/",templateUrl:"/views/main.html",controller:"MainController",controllerAs:"app"}).state("home",{url:"/home",resolve:{fetchUser:["userFactory","userService","$localStorage",function(a,b,c){return b.user||a.saveUserToService(c.userId).then(function(){return b.user},function(a){console.log(a)})}],fetchAppointments:["apptFactory","apptService","$localStorage",function(a,b,c){return b.appointments||a.saveApptsToService(c.userId).then(function(){return b.appointments},function(a){console.log(a)})}],fetchAddresses:["addressFactory","addressService","$localStorage",function(a,b,c){return b.addresses||a.saveAddressesToService(c.userId).then(function(){return b.addresses},function(a){console.log(a)})}]},templateUrl:"/views/home.html",controller:"HomeController",controllerAs:"home"}).state("forbidden",{url:"/noAccess",templateUrl:"views/forbidden.html"})}]).run(["$rootScope","$location","$localStorage","AuthFactory",function(a,b,c,d){var e=c.spId,f=c.userId,g=c.adminId;d.check(),d.isLogged?(f&&b.path("/home"),e&&b.path("/sp/dashboard"),g&&b.path("/admin/dashboard")):b.path("/"),a.$on("$stateChangeStart",function(a,c){d.isLogged!==!0||!f||"/login"!==c.url&&"/register"!==c.url&&"/"!==c.url?d.isLogged!==!0||!e||"/serviceProviders/login"!==c.url&&"/serviceProviders/register"!==c.url&&"/"!==c.url?d.isLogged!==!0||!g||"/admin/login"!==c.url&&"/admin/register"!==c.url&&"/"!==c.url?d.isLogged===!1&&b.path("/"):b.path("/admin/dashboard"):b.path("/sp/dashboard"):b.path("/home")})}]),angular.module("homey").config(["$stateProvider",function(a){a.state("userLogin",{url:"/users/login",templateUrl:"/login/userLogin.html",controller:"UserLoginController",controllerAs:"auth"}).state("userRegister",{url:"/users/register",templateUrl:"/login/userRegister.html",controller:"UserLoginController",controllerAs:"auth"}).state("serviceProviderLogin",{url:"/serviceProviders/login",templateUrl:"/login/serviceProviderLogin.html",controller:"ServiceProviderLoginController",controllerAs:"spAuth"}).state("serviceProviderRegister",{url:"/serviceProviders/register",templateUrl:"/login/serviceProviderRegister.html",controller:"ServiceProviderLoginController",controllerAs:"spAuth"}).state("adminLogin",{url:"/admin/login",templateUrl:"/login/adminLogin.html",controller:"AdminLoginController",controllerAs:"adminAuth"}).state("adminRegister",{url:"/admin/register",templateUrl:"/login/adminRegister.html",controller:"AdminLoginController",controllerAs:"adminAuth"})}]),angular.module("homey").config(["$stateProvider",function(a){a.state("profile",{url:"/profile",resolve:{user:["userService",function(a){return a.user}]},templateUrl:"/users/profile.html",controller:"UserController",controllerAs:"user"}).state("edit",{url:"/edit",resolve:{user:["userService",function(a){return a.user}]},templateUrl:"/users/edit.html",controller:"EditController",controllerAs:"edit"})}]),angular.module("homey").config(["$stateProvider",function(a){a.state("appointments",{url:"/appointments",resolve:{appointments:["apptService",function(a){return a.appointments}]},templateUrl:"/appointments/index.html",controller:"AppointmentController",controllerAs:"appt"}).state("newAppointment",{url:"/appointments/new",resolve:{serviceType:function(){return""},addresses:["addressService",function(a){return a.addresses}]},templateUrl:"appointments/new.html",controller:"BookingController",controllerAs:"book"})}]),angular.module("homey").config(["$stateProvider",function(a){a.state("newAppointment.homeCleaning",{url:"/home-cleaning",resolve:{serviceType:function(){return"home-cleanings"},addresses:["addressService",function(a){return a.addresses}]},views:{service:{templateUrl:"bookings/services/home-cleaning.html",controller:"HomeCleaningController",controllerAs:"hc"}}}).state("newAppointment.officeCleaning",{url:"/office-cleaning",resolve:{serviceType:function(){return"office-cleanings"},addresses:["addressService",function(a){return a.addresses}]},views:{service:{templateUrl:"bookings/services/office-cleaning.html",controller:"OfficeCleaningController",controllerAs:"oc"}}}).state("newAppointment.carWash",{url:"/car-wash",resolve:{serviceType:function(){return"car-washes"},addresses:["addressService",function(a){return a.addresses}]},views:{service:{templateUrl:"bookings/services/car-wash.html",controller:"CarWashController",controllerAs:"car"}}}).state("newAppointment.driver",{url:"/driver",resolve:{serviceType:function(){return"drivers"},addresses:["addressService",function(a){return a.addresses}]},views:{service:{templateUrl:"bookings/services/driver.html",controller:"DriverController",controllerAs:"driver"}}}).state("newAppointment.security",{url:"/security",resolve:{serviceType:function(){return"securities"},addresses:["addressService",function(a){return a.addresses}]},views:{service:{templateUrl:"bookings/services/security.html",controller:"SecurityController",controllerAs:"sc"}}}).state("newAppointment.chef",{url:"/chef",resolve:{serviceType:function(){return"chefs"},addresses:["addressService",function(a){return a.addresses}]},views:{service:{templateUrl:"bookings/services/chef.html",controller:"ChefController",controllerAs:"chef"}}}).state("newAppointment.gardening",{url:"/gardening",resolve:{serviceType:function(){return"gardenings"},addresses:["addressService",function(a){return a.addresses}]},views:{service:{templateUrl:"bookings/services/gardening.html",controller:"GardeningController",controllerAs:"gardening"}}}).state("newAppointment.contractor",{url:"/contractor",resolve:{serviceType:function(){return"contractors"},addresses:["addressService",function(a){return a.addresses}]},views:{service:{templateUrl:"bookings/services/contractor.html",controller:"BookingController",controllerAs:"book"}}})}]),angular.module("homey").config(["$stateProvider",function(a){a.state("spDashboard",{url:"/sp/dashboard",resolve:{fetchServiceProvider:["spFactory","spService","$localStorage",function(a,b,c){return b.sp||a.saveSPToService(c.spId).then(function(){return b.sp},function(a){console.log(a)})}],upcomingAppointments:["spApptFactory","spApptService","$localStorage",function(a,b,c){return b.appointments||a.saveUpcomingToService(c.spId).then(function(){return b.upcoming},function(a){console.log(a)})}],pastAppointments:["spApptFactory","spApptService","$localStorage",function(a,b,c){return b.appointments||a.savePastToService(c.spId).then(function(){return b.past},function(a){console.log(a)})}]},templateUrl:"/serviceProviders/dashboard.html",controller:"serviceProviderController",controllerAs:"sp"}).state("editServiceProvider",{url:"/serviceProvider/edit",templateUrl:"/serviceProviders/edit.html",controller:"serviceProviderEditController",controllerAs:"spEdit"})}]),angular.module("homey").config(["$stateProvider","$httpProvider",function(a){a.state("adminDashboard",{url:"/admin/dashboard",resolve:{fetchAdmin:["adminFactory","adminService","$localStorage",function(a,b,c){return b.admin||a.saveAdminToService(c.adminId).then(function(){return b.admin},function(a){console.log(a)})}],providers:["spFactory","spService",function(a,b){return b.providers||a.saveProvidersToService().then(function(){return b.providers},function(a){console.log(a)})}],upcomingAppointments:["adApptFactory","adApptService",function(a,b){return b.upcoming||a.saveUpcomingToService().then(function(){return b.upcoming},function(a){console.log(a)})}],pastAppointments:["adApptFactory","adApptService",function(a,b){return b.past||a.savePastToService().then(function(){return b.past},function(a){console.log(a)})}],unassignedAppointments:["adApptFactory","adApptService",function(a,b){return b.unassigned||a.saveUnassignedToService().then(function(){return b.unassigned},function(a){console.log(a)})}]},templateUrl:"/admin/dashboard.html",controller:"AdminController",controllerAs:"admin"}).state("editAdmin",{url:"/admin/edit",templateUrl:"/admin/edit.html",controller:"AdminEditController",controllerAs:"adminEdit"})}]),angular.module("homey").config(["$stateProvider",function(a){a.state("discounts",{url:"/discounts",templateUrl:"discounts/new.html",controller:"DiscountController",controllerAs:"dc"})}]),angular.module("homey").config(["$stateProvider",function(a){a.state("edit.addresses",{url:"/addresses",resolve:{addresses:["addressService",function(a){return a.addresses}]},views:{addresses:{templateUrl:"addresses/index.html",controller:"AddressController",controllerAs:"address"}}}).state("edit.addresses.new",{url:"/addresses/new",views:{newAddress:{templateUrl:"addresses/new.html",controller:"NewAddressController",controllerAs:"newAddress"}}}).state("newAppointment.homeCleaning.newAddress",{url:"/addresses/new",views:{newAddress:{templateUrl:"addresses/new.html",controller:"NewAddressController",controllerAs:"newAddress"}}}).state("newAppointment.officeCleaning.newAddress",{url:"/addresses/new",views:{newAddress:{templateUrl:"addresses/new.html",controller:"NewAddressController",controllerAs:"newAddress"}}}).state("newAppointment.carWash.newAddress",{url:"/addresses/new",views:{newAddress:{templateUrl:"addresses/new.html",controller:"NewAddressController",controllerAs:"newAddress"}}}).state("newAppointment.driver.newAddress",{url:"/addresses/new",views:{newAddress:{templateUrl:"addresses/new.html",controller:"NewAddressController",controllerAs:"newAddress"}}}).state("newAppointment.security.newAddress",{url:"/addresses/new",views:{newAddress:{templateUrl:"addresses/new.html",controller:"NewAddressController",controllerAs:"newAddress"}}}).state("newAppointment.chef.newAddress",{url:"/addresses/new",views:{newAddress:{templateUrl:"addresses/new.html",controller:"NewAddressController",controllerAs:"newAddress"}}}).state("newAppointment.gardening.newAddress",{url:"/addresses/new",views:{newAddress:{templateUrl:"addresses/new.html",controller:"NewAddressController",controllerAs:"newAddress"}}}).state("newAppointment.contractor.newAddress",{url:"/addresses/new",views:{newAddress:{templateUrl:"addresses/new.html",controller:"NewAddressController",controllerAs:"newAddress"}}})}]),angular.module("homey").config(["$stateProvider",function(a){a.state("payments",{url:"/payments",templateUrl:"/stripe/new.html",controller:"StripeController",controllerAs:"stripe"})}]),angular.module("homey").controller("MainController",["fbFactory",function(a){var b=this;a.initialize(),b.fbLogin=a.fbLogin}]),angular.module("homey").controller("HomeController",["$state","userLoginFactory","Middleware",function(a,b,c){c.redirectToForbidden("user");var d=this;d.logout=b.logout}]),angular.module("homey").controller("UserLoginController",["$state","userLoginFactory",function(a,b){var c=this;c.userForm={},c.register=function(){b.register(c.userForm).then(function(){c.userForm={},a.go("home")},function(a){console.log(a)})},c.login=function(){b.login(c.userForm).then(function(){c.userForm={},a.go("home")},function(a){console.log(a)})}}]).controller("ServiceProviderLoginController",["$state","spLoginFactory",function(a,b){var c=this;c.spForm={},c.register=function(){b.register(c.spForm).then(function(){c.spForm={},a.go("spDashboard")},function(a){console.log(a)})},c.login=function(){b.login(c.spForm).then(function(){c.spForm={},a.go("spDashboard")},function(a){console.log(a)})}}]).controller("AdminLoginController",["$state","adminLoginFactory",function(a,b){var c=this;c.adminForm={},c.register=function(){b.register(c.adminForm).then(function(){c.adminForm={},a.go("adminDashboard")},function(a){console.log(a)})},c.login=function(){b.login(c.adminForm).then(function(){c.adminForm={},a.go("adminDashboard")},function(a){console.log(a)})}}]),angular.module("homey").controller("UserController",["$state","user","userService","userFactory","Middleware",function(a,b,c,d,e){e.redirectToForbidden("user");var f=this;f.info=b,f.info.genderType=0===f.info.gender?"Male":"Female",f["delete"]=function(){d.deleteUser().then(function(){a.go("/")},function(a){console.log(a)})}}]).controller("EditController",["$state","user","userService","userFactory","Middleware",function(a,b,c,d,e){e.redirectToForbidden("user");var f=this;f.editForm=b,f.editUser=function(){d.edit(f.editForm).then(function(){f.editForm={},a.go("profile")},function(a){console.log(a)})}}]),angular.module("homey").controller("AppointmentController",["$filter","appointments","apptFactory","userService","Middleware",function(a,b,c,d,e){e.redirectToForbidden("user");var f=this;f.user=d.user,f.appointments=b,console.log(f.appointments),f.upcoming=a("upcomingFilter")(f.appointments),f.past=a("pastFilter")(f.appointments),f.pay=c.pay,f.cancel=c.cancel,f.complete=c.complete}]),angular.module("homey").controller("HomeCleaningController",["bookingFactory","serviceType","addresses","addressFactory","Middleware",function(a,b,c,d,e){function f(){i.laundry=!0}function g(){i.laundry=!1,delete i.formData.loads,delete i.formData.ironed}function h(a){1===a?(i.formData.bedrooms=2,i.formData.bathrooms=2,i.formData.kitchens=1,i.formData.livingrooms=1):2===a&&(i.formData.bedrooms=3,i.formData.bathrooms=3,i.formData.kitchens=1,i.formData.livingrooms=1)}e.redirectToForbidden("user");var i=this;i.addresses=c,i.destroyAddy=d.destroy,i.formData={bedrooms:0,bathrooms:0,kitchens:0,livingrooms:0,loads:0,ironed:0},i.laundry=!1,i.flatRate=h,i.showLaundry=f,i.cancelLaundry=g,i.serviceType=b,i.submitData=a.create}]).controller("OfficeCleaningController",["bookingFactory","serviceType","addresses","addressFactory","Middleware",function(a,b,c,d,e){e.redirectToForbidden("user");var f=this;f.addresses=c,f.serviceType=b,f.submitData=a.create,f.destroyAddy=d.destroy}]).controller("CarWashController",["bookingFactory","serviceType","addresses","addressFactory","Middleware",function(a,b,c,d,e){e.redirectToForbidden("user");var f=this;f.addresses=c,f.serviceType=b,f.submitData=a.create,f.destroyAddy=d.destroy}]).controller("DriverController",["bookingFactory","serviceType","addresses","addressFactory","Middleware",function(a,b,c,d,e){function f(){for(var a=0;a<h.formData.providers;a++)h.formData.cars.push({});h.ifCars=!0}function g(a){h.formData.cars.splice(a,1),h.formData.providers=h.formData.cars.length}e.redirectToForbidden("user");var h=this;h.addresses=c,h.formData={cars:[]},h.ifCars=!1,h.addCars=f,h.removeCar=g,h.serviceType=b,h.submitData=a.create,h.destroyAddy=d.destroy}]).controller("SecurityController",["bookingFactory","serviceType","addresses","addressFactory","Middleware",function(a,b,c,d,e){function f(){for(var a=0;a<h.formData.providers;a++)h.formData.guards.push({});h.ifGuards=!0}function g(a){h.formData.guards.splice(a,1),h.formData.providers=h.formData.guards.length}e.redirectToForbidden("user");var h=this;h.addresses=c,h.formData={guards:[]},h.ifGuards=!1,h.serviceType=b,h.addGuards=f,h.removeGuard=g,h.submitData=a.create,h.destroyAddy=d.destroy}]).controller("ChefController",["bookingFactory","serviceType","$window","addresses","addressFactory","Middleware",function(a,b,c,d,e,f){f.redirectToForbidden("user");var g=this;g.addresses=d,g.Math=c.Math,g.formData={serving_size:0},g.serviceType=b,g.submitData=a.create,g.destroyAddy=e.destroy}]).controller("GardeningController",["bookingFactory","serviceType","$window","addresses","addressFactory","Middleware",function(a,b,c,d,e,f){function g(){return j.formData.type=j.formData.type.trim(),","===j.formData.type.slice(-1)?j.formData.type=j.formData.type.slice(0,-1):void 0}function h(a){j.formData.type+=j.services[a].name+", ",j.services[a].checked=!0}function i(){g(),a.create(j.formData,b)}f.redirectToForbidden("user");var j=this;j.addresses=d,j.Math=c.Math,j.formData={acres:0,type:""},j.services=[{name:"Grass Cutting",checked:!1},{name:"Hedge Trimming",checked:!1},{name:"Pruning",checked:!1},{name:"Plant Watering",checked:!1},{name:"Other (Please specify in notes)",checked:!1}],j.submitData=i,j.addService=h,j.destroyAddy=e.destroy}]).controller("BookingController",["bookingFactory","serviceType","addresses","addressFactory","Middleware",function(a,b,c,d,e){e.redirectToForbidden("user");var f=this;f.addresses=c,f.services=[{name:"Home Cleaning",state:"newAppointment.homeCleaning"},{name:"Office Cleaning",state:"newAppointment.officeCleaning"},{name:"Car Wash",state:"newAppointment.carWash"},{name:"Driver",state:"newAppointment.driver"},{name:"Security",state:"newAppointment.security"},{name:"Personal Chef",state:"newAppointment.chef"},{name:"Gardening",state:"newAppointment.gardening"},{name:"Contractor Job",state:"newAppointment.contractor"}],f.destroyAddy=d.destroy,f.submitData=function(){a.create(f.formData,b)}}]),angular.module("homey").controller("serviceProviderController",["$state","spService","spFactory","spLoginFactory","Middleware","upcomingAppointments","pastAppointments",function(a,b,c,d,e,f,g){var h=this;h.info=b.sp,h.info.genderType=0===h.info.gender?"Male":"Female",h.upcoming=f,h.past=g,console.log(h.past),h["delete"]=function(){c["delete"]().then(function(){a.go("/")},function(a){console.log(a)})},h.logout=d.logout}]).controller("serviceProviderEditController",["$state","spService","spFactory","Middleware",function(a,b,c,d){d.redirectToForbidden("sp");var e=this;e.editForm=b.sp,e.submitData=function(){c.edit(e.editForm).then(function(){e.editForm={},a.go("spDashboard")},function(a){console.log(a)})}}]),angular.module("homey").controller("AdminController",["$state","adminService","adminFactory","adminLoginFactory","adApptFactory","adApptService","Middleware","upcomingAppointments","pastAppointments","unassignedAppointments","providers",function(a,b,c,d,e,f,g,h,i,j,k){var l=this;l.info=b.admin,l.providers=k,console.log(k),l.upcoming=h,l.past=i,l.unassigned=j,l["delete"]=function(){c["delete"]().then(function(){a.go("/")},function(a){console.log(a)})},l.assign=function(a,b){c.assign(a,b).then(function(){l.upcoming=e.saveUpcomingToService(),l.unassigned=e.saveUnassignedToService()},function(a){console.log(a)})},l.logout=d.logout}]).controller("AdminEditController",["$state","adminService","adminFactory","Middleware",function(a,b,c,d){d.redirectToForbidden("admin");var e=this;e.editForm=b.admin,e.submitData=function(){c.edit(e.editForm).then(function(){e.editForm={},a.go("adminDashboard")},function(a){console.log(a)})}}]),angular.module("homey").controller("DiscountController",["discountFactory","Middleware",function(a,b){function c(){a.generateDiscountCode(d.formData)}b.redirectToForbidden("admin");var d=this;d.submitData=c}]),angular.module("homey").controller("AddressController",["addresses","addressFactory",function(a,b){var c=this;c.destroy=b.destroy,c.formData={},c.all=a}]).controller("NewAddressController",["addressFactory",function(a){var b=this;b.create=a.create}]),angular.module("homey").controller("StripeController",["stripeFactory",function(a){function b(b,c){200==b?a.chargeCustomer(c.id):(console.log("response",c.error.message),console.log("status",b),console.log("failure"))}function c(){Stripe.setPublishableKey("pk_live_n41TBlX0lvSs04xM9Kh983ai"),Stripe.card.createToken(e,b)}var d=this,e=$("#payment-form");d.createStripeToken=c}]),angular.module("homey").factory("ajaxFactory",["$http","$q",function(a,b){return{request:function(c,d,e){var f=b.defer();switch(d){case"get":!function(){a.get(c).success(function(a){f.resolve(a)}).error(function(a){f.reject(a.error)})}();break;case"post":!function(){a.post(c,e).success(function(a){f.resolve(a)}).error(function(a){f.reject(a.error)})}();break;case"put":!function(){a.put(c,e).success(function(a){f.resolve(a)}).error(function(a){f.reject(a.error)})}();break;case"delete":!function(){a["delete"](c).success(function(a){f.resolve(a)}).error(function(a){f.reject(a.error)})}()}return f.promise}}}]),angular.module("homey").factory("AuthInterceptor",["$q","$injector",function(a,b){return{request:function(c){var d=b.get("AuthToken"),e=d.get();return c.headers=c.headers||{},e&&(c.headers.Authorization="Bearer "+e),c||a.when(c)}}}]),angular.module("homey").factory("Middleware",["$state","adminService","userService","spService",function(a,b,c,d){return{redirectToForbidden:function(e){switch(e){case"admin":if(void 0===b.admin)return a.go("forbidden");break;case"user":if(void 0===c.user)return a.go("forbidden");break;case"sp":if(void 0===d.sp)return a.go("forbidden")}}}}]),angular.module("homey").factory("AuthFactory",["$localStorage",function(a){var b={isLogged:!1,check:function(){a.token&&(a.userId||a.spId||a.adminId)?this.isLogged=!0:(this.isLogged=!1,a.userId&&delete a.userId,a.spId&&delete a.spId,a.adminId&&delete a.adminId,delete a.token)}};return b}]),angular.module("homey").factory("fbFactory",["userLoginFactory","$state",function(a,b){return{initialize:function(){window.fbAsyncInit=function(){FB.init({appId:"836908086372942",xfbml:!0,version:"v2.2"})},function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/en_US/sdk.js",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk")},fbLogin:function(){FB.login(function(c){"connected"===c.status?FB.api("/me",function(c){a.fbLogin(c).then(function(){b.go("home")},function(a){console.log(a)})}):console.log("not_authorized"===c.status?"Please log in locally.":"Yo, log in brotha.")},{scope:"public_profile,email"})}}}]),angular.module("homey").factory("userLoginFactory",["$http","$q","$localStorage","$state","AuthToken","AuthFactory","userService",function(a,b,c,d,e,f,g){return{register:function(c){var d=b.defer();return a.post("http://localhost:3000/api/register",c).success(function(a){e.set(a),f.isLogged=!0,d.resolve(a)}).error(function(a){d.reject(a.error)}),d.promise},login:function(c){var d=b.defer();return a.post("http://localhost:3000/api/login",{email:c.email,password:c.password}).success(function(a){e.set(a),f.isLogged=!0,d.resolve(a)}).error(function(a){d.reject(a.error)}),d.promise},logout:function(){delete c.token,delete c.userId,f.isLogged=!1,delete g.user,d.go("/")},fbLogin:function(c){var d=b.defer();return a.post("http://localhost:3000/api/fb",c).success(function(a){e.set(a),f.isLogged=!0,d.resolve(a)}).error(function(a){console.log(a.error),d.reject(a.error)}),d.promise}}}]).factory("spLoginFactory",["$http","$q","$localStorage","$state","AuthToken","AuthFactory","spService",function(a,b,c,d,e,f,g){return{register:function(c){var d=b.defer();return a.post("http://localhost:3000/api/serviceProviders/register",c).success(function(a){e.set(a),f.isLogged=!0,d.resolve(a)}).error(function(a){d.reject(a.error)}),d.promise},login:function(c){var d=b.defer();return a.post("http://localhost:3000/api/serviceProviders/login",{email:c.email,password:c.password}).success(function(a){e.set(a),f.isLogged=!0,d.resolve(a)}).error(function(a){d.reject(a.error)}),d.promise},logout:function(){delete c.token,delete c.spId,f.isLogged=!1,delete g.sp,d.go("/")}}}]).factory("adminLoginFactory",["$http","$q","$localStorage","$state","AuthToken","AuthFactory","adminService",function(a,b,c,d,e,f,g){return{register:function(c){var d=b.defer();return a.post("http://localhost:3000/api/admins/register",c).success(function(a){e.set(a),f.isLogged=!0,d.resolve(a)}).error(function(a){d.reject(a.error)}),d.promise},login:function(c){var d=b.defer();return a.post("http://localhost:3000/api/admins/login",{email:c.email,password:c.password}).success(function(a){e.set(a),f.isLogged=!0,d.resolve(a)}).error(function(a){d.reject(a.error)}),d.promise},logout:function(){delete c.token,delete c.adminId,f.isLogged=!1,delete g.admin,d.go("/")}}}]),angular.module("homey").factory("userFactory",["$http","$q","$localStorage","userService",function(a,b,c,d){return{saveUserToService:function(c){var e=b.defer();return a.get("http://localhost:3000/api/users/"+c).success(function(a){d.user=a,d.user.birthday=new Date(a.birthday),e.resolve(a)}).error(function(a){e.reject(a)}),e.promise},deleteUser:function(d){var e=b.defer();return a["delete"]("http://localhost:3000/api/users/"+d+"/delete").success(function(a){delete c.token,delete c.userId,e.resolve(a)}).error(function(a){e.reject(a)}),e.promise},edit:function(c){var e=b.defer(),f=c.id;return a.put("http://localhost:3000/api/users/"+f+"edit",{email:c.email,first_name:c.first_name,last_name:c.last_name,gender:c.gender,age:c.age,phone:c.phone}).success(function(a){d.user=a,e.resolve(a.user)}).error(function(a){e.reject(a.error)}),e.promise}}}]),angular.module("homey").factory("apptFactory",["$localStorage","ajaxFactory","apptService",function(a,b,c){function d(a){var d="http://localhost:3000/api/users/"+a+"/appointments";return c.appointments=b.request(d,"get")}function e(c){var e="http://localhost:3000/api/users/"+c+"/appointments";b.request(e,"post").then(function(){d(a.userId)},function(a){console.log(a)})}function f(c){var e="http://localhost:3000/api/appointments/"+c+"/pay";b.request(e,"put").then(function(){d(a.userId)},function(a){console.log(a)})}function g(c){var e="http://localhost:3000/api/appointments/"+c+"/complete";b.request(e,"put").then(function(){d(a.userId)},function(a){console.log(a)})}function h(c){var e="http://localhost:3000/api/appointments/"+c+"/cancel";b.request(e,"put").then(function(){d(a.userId)},function(a){console.log(a)})}return{saveApptsToService:d,book:e,pay:f,complete:g,cancel:h}}]).factory("adApptFactory",["ajaxFactory","adApptService",function(a,b){function c(){var c="http://localhost:3000/api/appointments/upcoming";return b.upcoming=a.request(c,"get")}function d(){var c="http://localhost:3000/api/appointments/past";return b.past=a.request(c,"get")}function e(){var c="http://localhost:3000/api/appointments/unassigned";return b.unassigned=a.request(c,"get")}return{saveUpcomingToService:c,savePastToService:d,saveUnassignedToService:e}}]).factory("spApptFactory",["ajaxFactory","spApptService",function(a,b){function c(c){var d="http://localhost:3000/api/sp/"+c+"/appointments/upcoming";return b.upcoming=a.request(d,"get")}function d(c){var d="http://localhost:3000/api/sp/"+c+"/appointments/past";return b.past=a.request(d,"get")}return{saveUpcomingToService:c,savePastToService:d}}]),angular.module("homey").factory("bookingFactory",["$http","$localStorage","$state","ajaxFactory","apptFactory",function(a,b,c,d,e){function f(a,f){var g="http://localhost:3000/api/appointments/bookings/"+f;d.request(g,"post",a).then(function(){e.saveApptsToService(b.userId).then(function(){c.go("appointments")},function(a){console.log(a)})},function(a){console.log(a)})}return{create:f}}]),angular.module("homey").factory("spFactory",["$http","$q","$localStorage","spService",function(a,b,c,d){return{saveSPToService:function(c){var e=b.defer();return a.get("http://localhost:3000/api/serviceProviders/"+c).success(function(a){d.sp=a,d.sp.birthday=new Date(a.birthday),e.resolve(a)}).error(function(a){e.reject(a)}),e.promise},saveProvidersToService:function(){var c=b.defer();return a.get("http://localhost:3000/api/serviceProviders").success(function(a){d.providers=a,c.resolve(a)}).error(function(a){c.reject(a)}),c.promise},"delete":function(d){var e=b.defer();return a["delete"]("http://localhost:3000/api/serviceProviders/"+d+"/delete").success(function(a){delete c.token,delete c.spId,e.resolve(a)}).error(function(a){e.reject(a)}),e.promise},edit:function(c){var e=b.defer(),f=c.id;return a.put("http://localhost:3000/api/serviceProviders/"+f+"/edit",{email:c.email,first_name:c.first_name,last_name:c.last_name,gender:c.gender,age:c.age,phone:c.phone,birthday:c.birthday,address:c.address,service:c.service,years_experience:c.years_experience}).success(function(a){d.sp=a,e.resolve(a.sp)}).error(function(a){e.reject(a.error)}),e.promise}}}]),angular.module("homey").factory("adminFactory",["$http","$q","$localStorage","$state","adminService","adApptFactory",function(a,b,c,d,e){return{saveAdminToService:function(c){var d=b.defer();return a.get("http://localhost:3000/api/admins/"+c).success(function(a){e.admin=a,e.admin.birthday=new Date(a.birthday),d.resolve(a)}).error(function(a){d.reject(a)}),d.promise},"delete":function(d){var e=b.defer();return a["delete"]("http://localhost:3000/api/admins/"+d+"/delete").success(function(a){delete c.token,delete c.adminId,e.resolve(a)}).error(function(a){e.reject(a)}),e.promise},edit:function(c){var d=b.defer(),f=c.id;return a.put("http://localhost:3000/api/admins/"+f+"/edit",{email:c.email,first_name:c.first_name,last_name:c.last_name,gender:c.gender,birthday:c.birthday,phone:c.phone}).success(function(a){e.admin=a,d.resolve(a)}).error(function(a){d.reject(a.error)}),d.promise},assign:function(c,d){var e=b.defer();return a.post("http://localhost:3000/api/assignments",{appointment_id:c.id,service_provider_id:d.id}).success(function(a){e.resolve(a)}).error(function(a){e.reject(a.error)}),e.promise}}}]),angular.module("homey").factory("discountFactory",["ajaxFactory","$state",function(a,b){function c(c){var d="http://localhost:3000/api/admins/"+c.admin_id+"/discounts";a.request(d,"post",c).then(function(){b.go("adminDashboard")},function(a){console.log(a)})}return{generateDiscountCode:c}}]),angular.module("homey").factory("addressFactory",["$localStorage","$state","ajaxFactory","addressService",function(a,b,c,d){function e(d){var e="http://localhost:3000/api/addresses";c.request(e,"post",d).then(function(){h(a.userId).then(function(){b.reload()},function(a){console.log(a)})},function(a){console.log(a)})}function f(d,e){var f="http://localhost:3000/api/addresses/"+d+"/edit";c.request(f,"put",e).then(function(){h(a.userId).then(function(){b.reload()},function(a){console.log(a)})},function(a){console.log(a)})}function g(d){var e="http://localhost:3000/api/addresses/"+d+"/delete";c.request(e,"delete").then(function(){h(a.userId).then(function(){b.reload()},function(a){console.log(a)})},function(a){console.log(a)})}function h(a){var b="http://localhost:3000/api/users/"+a+"/addresses";return d.addresses=c.request(b,"get")}return{create:e,saveAddressesToService:h,edit:f,destroy:g}}]),angular.module("homey").factory("stripeFactory",["ajaxFactory",function(a){function b(b){var c="http://localhost:3000/api/charges/stripe";a.request(c,"post",{stripeToken:b}).then(function(a){console.log(a)},function(a){console.log(a)})}return{chargeCustomer:b}}]),angular.module("homey").factory("AuthToken",["$localStorage",function(a){return{set:function(b){a.token=b.token,b.userId?a.userId=b.userId:b.spId?a.spId=b.spId:b.adminId&&(a.adminId=b.adminId)},get:function(){return a.token}}}]),angular.module("homey").factory("userService",[function(){return{}}]),angular.module("homey").factory("apptService",[function(){return{}}]).factory("adApptService",[function(){return{}}]).factory("spApptService",[function(){return{}}]),angular.module("homey").factory("spService",[function(){return{}}]),angular.module("homey").factory("adminService",[function(){return{}}]),angular.module("homey").factory("addressService",[function(){return{}}]),angular.module("homey").filter("upcomingFilter",[function(){return function(a){var b=[],c=Date.now();if(a&&a.length>0)for(var d=0;d<a.length;d++){var e=new Date(a[d].service_date);e>=c&&b.push(a[d])}return b}}]).filter("pastFilter",[function(){return function(a){var b=[],c=Date.now();if(a&&a.length>0)for(var d=0;d<a.length;d++){var e=new Date(a[d].service_date);c>=e&&b.push(a[d])}return b}}]);